import socket
import re
import common_ports

def get_open_ports(target, port_range, verbose=False):
  is_IP = True if re.match('[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}', target) else False
  try:
    URL = socket.gethostbyaddr(target)[0] if is_IP else target
  except Exception:
    URL = ''
  finally:
    try:
      IP = target if is_IP else socket.gethostbyname(target)
      text = f'{URL} ({IP})' if len(URL) > 0 else f'{IP}'
      open_ports = [] if not verbose else f'Open ports for {text}\nPORT     SERVICE'
      for port in range(port_range[0], port_range[1] + 1):
        my_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        my_socket.settimeout(1)
        if not my_socket.connect_ex((target, port)):
          if verbose:
            name = common_ports.ports_and_services.get(port)
            open_ports += f'\n{port}'
            for _ in range(9 - len(str(port))):
              open_ports += ' '
            open_ports += f'{name}'
          else:
            open_ports.append(port)
        my_socket.close()
      return(open_ports)
    except Exception:
      return "Error: Invalid IP address" if is_IP else "Error: Invalid hostname"